<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <title>Drugs</title>

    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.0.1/css/bootstrap.min.css}"/>
    <script th:src="@{/webjars/jquery/3.6.0/jquery.min.js/}"></script>
    <script th:src="@{/webjars/bootstrap/5.0.1/js/bootstrap.min.js}"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-
beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-
giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-
beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-
ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>
</head>
<body>

<h1 class="mb-5 text-center">Drugs List</h1>

<div class="overflow-auto">
    <table id="drug-table" class="table h-75">
        <thead class="table-dark">
        <tr>
            <td>Name</td>
            <td>Manufacture Date</td>
            <td>Manufacture Address</td>
            <td>Availability</td>
            <td>Contraindications</td>
        </tr>
        </thead>
        <tbody id="drug-body">
        </tbody>
    </table>
</div>
<nav aria-label="Page navigation example" class="text-center">
    <ul class="pagination" id="pagination">
    </ul>
</nav>
</body>
</html>
<script>
    //
    let currentPage = 1;
    getDrugs(currentPage);

    function getDrugs(page) {

        let pageSize = 20;

        $.ajax({
            url: 'http://localhost:8082/api/drugs/list-pageable?page=' + page + '&?size=' + pageSize,
            type: 'GET',
            contentType: "application/json",

            success: function (res) {

                let totalPages = res.totalPages;
                const $pagination = $('#pagination');

                $pagination.empty();

                for (let i = 0; i < totalPages; i++) {
                    $pagination.append(`<li class="page-item"><a class="page-link" href="#">${i + 1}</a></li>`)
                }

                let content = res.content;
                const $tableBody = $('#drug-body');

                $tableBody.empty();

                content.forEach(function (item) {
                    $tableBody.append(`<tr><td>${item.name}</td>
                                     <td>${item.manufactureDate}</td>
                                     <td>${item.manufacturer.name} ${item.manufacturer.city} ${item.manufacturer.street}</td>
                                     <td>${item.coordinates.latitude} ${item.coordinates.longitude}</td>
                                     <td>${item.contraindications}</td></tr>`);
                });
            }
        });
    }

    $('body').on('click', '.page-item', function () {
        currentPage = $(this).find('a').text();
        getDrugs(currentPage);
    });

</script>