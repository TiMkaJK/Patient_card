<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1">
    <title>Add Patient</title>
    <!--    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.0.1/css/bootstrap.min.css}"/>-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-
beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-
giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-
beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-
ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<!--    <script th:src="@{/webjars/jquery/3.6.0/jquery.min.js/}"></script>-->
    <!--    <script th:src="@{/webjars/bootstrap/5.0.1/js/bootstrap.min.js}"></script>-->
</head>
<body>
<div class="container text-center">
    <div>
        <h1>Add Patient</h1>
    </div>
    <form th:action="@{/patients/save}" id="patient-form" class="border" method="post"
          style="max-width: 600px; margin: 0 auto;">
        <div class="m-3">
            <div class="form-group row mt-3">
                <label class="col-4 col-form-label">First Name : </label>
                <div class="col-8">
                    <input id="first-name" type="text" class="w-100 h-100" required/>
                </div>
            </div>

            <div class="form-group row mt-3">
                <label class="col-4 col-form-label">Last Name : </label>
                <div class="col-8">
                    <input type="text" id="last-name" class="w-100 h-100" required minlength="6"
                           maxlength="10"/>
                </div>
            </div>

            <div class="form-group row mt-3">
                <label class="col-4 col-form-label">Admission Date : </label>
                <div class="col-8">
                    <input type="datetime-local" id="admission-date" class="w-100 h-100"
                           maxlength="20"/>
                </div>
            </div>
            <div class="form-group row mt-3">
                <label class="col-4 col-form-label">Clinic : </label>
                <div class="dropdown col-8">
                    <select id="clinic-list" class="col-8 w-100 h-100"></select>
                </div>
            </div>

            <div class="form-group row mt-3">
                <label class="col-4 col-form-label">User : </label>
                <div class="dropdown col-8">
                    <select id="user-list" class="col-8 w-100 h-100"></select>
                </div>
            </div>

            <div class="form-group row mt-3">
                <label class="col-4 col-form-label">Floor : </label>
                <div class="col-8">
                    <input type="number" id="floor" class="w-100 h-100" maxlength="20"/>
                </div>
            </div>

            <div class="form-group row mt-3">
                <label class="col-4 col-form-label">Ward : </label>
                <div class="col-8">
                    <input type="number" id="ward" class="w-100 h-100" required minlength="2"
                           maxlength="20"/>
                </div>
            </div>

            <div class="col-sm-6 offset-3 mt-3">
                <button type="submit" id="submit" class="btn btn-dark">Sign Up</button>
            </div>
        </div>
    </form>
</div>
</body>
<script>
    fetch('http://localhost:8082/api/users/list')
        .then(function (res) {
            return res.json();
        })
        .then(function (res) {

            const $usersList = $('#user-list');

            res.forEach(function (item) {
                let $user = $(`<option value="${item.id}">${item.firstName} ${item.lastName}</option>`);
                $usersList.append($user);
            });
        });

    fetch('http://localhost:8082/api/clinics/list')
        .then(function (res) {
            return res.json();
        })
        .then(function (res) {

            const $clinicList = $('#clinic-list');

            res.forEach(function (item) {
                let $clinic = $(`<option value="${item.id}">${item.name}</option>`);
                $clinicList.append($clinic);
            });
        });

    $('#patient-form').on('submit', function (event) {
        event.preventDefault();
    })

    $('#submit').on('click' , function (event) {
        let firstName = $('#first-name').val();
        let lastName = $('#last-name').val();
        let admissionDate = $('#admission-date').val();
        let ward = $('#ward').val();
        let floor = $('#floor').val();

        console.log(admissionDate);

        let patientObject = {
            "firstName": firstName,
            "lastName": lastName,
            "admissionDate": admissionDate,
            "user": {
                id: 1
            },
            "clinic": {
                id: 2
            },
            "diagnoses": [],
            "allergies":[],
            "patientDrugs":[],
            "ward": ward,
            "floor": floor,
        }

        $.ajax({
            url: 'http://localhost:8082/api/patients/save',
            type: "POST",
            dataType: "json",
            contentType: "application/json",
            data: JSON.stringify(patientObject),
            success: function(result){
                location.assign("/admin");
            }
        });


    })

</script>
</html>